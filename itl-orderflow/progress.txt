# ITL OrderFlow - Прогресс разработки
# Обновлено: 29.01.2025

================================================================================
## ФАЗА 1: Инициализация проекта [ЗАВЕРШЕНО]
================================================================================

[x] Структура проекта Next.js 14
[x] Конфигурация TypeScript
[x] Настройка Tailwind CSS
[x] Prisma схема БД (полная из PRD)
[x] Базовые UI компоненты (Button, Card, Input, Badge, etc.)

================================================================================
## ФАЗА 2: Базовые страницы [ЗАВЕРШЕНО]
================================================================================

[x] Layout с sidebar (collapsible)
[x] Header с поиском и уведомлениями
[x] Страница логина (без SaaS регистрации)
[x] Страница восстановления пароля
[x] Главный дашборд (KPI, графики, активность)
[x] Страница клиентов (таблица с поиском)
[x] Страница заказов (Kanban + Table view)
[x] Страница задач (Kanban board)
[x] Страница учёта времени (недельный таймшит)
[x] Страница финансов (счета, статистика)
[x] Страница отчётов
[x] Страница настроек (навигация)

================================================================================
## ФАЗА 3: Аутентификация [ЗАВЕРШЕНО]
================================================================================

[x] Auth.js конфигурация (JWT, Credentials)
[x] Credentials provider (email/password)
[x] Middleware для защиты маршрутов
[x] Session management (JWT 7 дней)
[x] Logout функционал

================================================================================
## ФАЗА 4: CRUD операции [ЗАВЕРШЕНО]
================================================================================

[x] Server Actions для клиентов (CRUD + контакты + архивация)
[x] Server Actions для заказов (CRUD + статусы + история)
[x] Server Actions для задач (CRUD + чеклисты + комментарии)
[x] Server Actions для учёта времени (CRUD + недельная сводка)
[x] Server Actions для счетов (CRUD + платежи + автонумерация)

================================================================================
## ФАЗА 5: Детальные страницы [ЗАВЕРШЕНО]
================================================================================

[x] Детальная страница клиента (инфо, контакты, заказы, счета)
[x] Детальная страница заказа (этапы, задачи, время, файлы, комментарии)
[x] Детальная страница задачи (статус, чеклист, комментарии, время)
[x] Редактор счёта (предпросмотр, позиции, платежи, действия)

================================================================================
## ФАЗА 6: Модальные окна [ЗАВЕРШЕНО]
================================================================================

[x] Модал создания клиента
[x] Модал создания заказа
[x] Select UI компонент (Radix)
[x] Модал создания задачи
[x] Модал добавления времени
[x] Модал создания счёта (с позициями и автосуммой)

================================================================================
## ФАЗА 7: Клиентский портал [ЗАВЕРШЕНО]
================================================================================

[x] Portal layout (header с навигацией, токен-авторизация)
[x] Portal login (по токену через cookie)
[x] Portal API route (/api/portal/auth)
[x] Portal dashboard (статистика, проекты, счета)
[x] Просмотр проекта (этапы, задачи, файлы, комментарии, счета)
[x] Согласование этапов (кнопка согласования, статус APPROVED)
[x] Портальные комментарии
[x] Страница счетов клиента
[x] Server Actions для портала
[x] Prisma schema: portalToken, portalEnabled, isPortalVisible, APPROVED статус

================================================================================
## ФАЗА 8: Дополнительные функции [ЗАВЕРШЕНО]
================================================================================

[x] Загрузка файлов (API upload + диалог + сохранение в БД)
    - src/app/api/files/upload/route.ts (локальный upload в public/uploads/)
    - src/components/files/file-upload-dialog.tsx (drag-n-drop, категории, видимость)
    - src/actions/files.ts (saveOrderFiles, deleteFile, toggleFileVisibility)
    - src/lib/uploadthing.ts (конфигурация для Uploadthing — готова к подключению)

[x] Таймер (floating widget)
    - src/components/timer/floating-timer.tsx (старт/пауза/стоп, выбор заказа)
    - src/components/timer/timer-provider.tsx (серверный wrapper с данными)
    - Автосохранение в TimeEntry при остановке таймера
    - Минимизированный вид с часами при закрытии панели

[x] Экспорт в Excel/PDF
    - src/app/api/export/time-entries/route.ts (CSV экспорт учёта времени)
    - src/app/api/export/invoices/route.ts (CSV экспорт счетов)
    - src/app/api/export/clients/route.ts (CSV экспорт клиентов)
    - src/app/(dashboard)/finance/[id]/print/page.tsx (печатная версия счёта)
    - Обновлённая страница отчётов с кнопками экспорта

[x] Email уведомления (Resend)
    - src/lib/email.ts (Resend клиент + 4 HTML шаблона)
    - src/actions/notifications.ts (отправка: счёт, статус заказа, этап, доступ)
    - Шаблоны: invoiceSent, orderStatus, milestoneReady, portalToken
    - Graceful fallback при отсутствии RESEND_API_KEY

================================================================================
## ИСПРАВЛЕНИЯ И УЛУЧШЕНИЯ
================================================================================

[x] Исправлены Decimal поля (Prisma) — Number() конвертация во всех actions
[x] Исправлены имена полей Invoice: total вместо totalAmount
[x] Исправлены имена полей Payment: paymentDate, paymentMethod
[x] Исправлено: task.dueDate вместо task.deadline
[x] Исправлено: milestone.clientApprovedAt вместо approvedAt
[x] Исправлено: File.isClientVisible вместо isPortalVisible в portal actions

================================================================================
## СТАТИСТИКА
================================================================================

Всего задач: 47
Завершено: 47
В работе: 0
Ожидает: 0

Прогресс: 100%

Структура проекта:
  Страницы (pages): 18
  Компоненты (components): 15
  Server Actions: 8 модулей
  API Routes: 6
  Библиотеки (lib): 5

================================================================================
## ДЛЯ ЗАПУСКА
================================================================================

1. pnpm install
2. Скопировать .env.example в .env и заполнить DATABASE_URL, AUTH_SECRET
3. npx prisma db push
4. npx prisma db seed
5. pnpm dev

Тестовые аккаунты (из seed):
  admin@itl.tj / admin123 (ADMIN)
  manager@itl.tj / admin123 (MANAGER)
  dev@itl.tj / admin123 (DEVELOPER)

================================================================================
